================================================================================
INSTRUCCIONES DE INTEGRACIÃ“N - Program.cs
================================================================================

ğŸ“Œ PASO 1: MODIFICAR Program.cs
================================================================================

Reemplazar la secciÃ³n de migraciones automÃ¡ticas en Program.cs:

CÃ“DIGO ACTUAL (lÃ­neas aproximadas 123-129):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
using (var scope = app.Services.CreateScope())
{
    var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();
    Console.WriteLine("ğŸ”„ Applying EF Core Migrations...");
    db.Database.Migrate();
    Console.WriteLine("âœ… Migrations applied successfully!");
}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

REEMPLAZAR POR:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
using (var scope = app.Services.CreateScope())
{
    var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();
    Console.WriteLine("ğŸ”„ Applying EF Core Migrations...");
    db.Database.Migrate();
    Console.WriteLine("âœ… Migrations applied successfully!");
    
    // ğŸŒ± DATABASE SEEDING
    Console.WriteLine("ğŸŒ± Seeding database...");
    await DatabaseSeeder.SeedAsync(scope.ServiceProvider);
}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

================================================================================
ğŸ“Œ PASO 2: MODIFICAR app.Run() AL FINAL
================================================================================

CÃ“DIGO ACTUAL (Ãºltima lÃ­nea):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
app.Run();
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

REEMPLAZAR POR:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
await app.RunAsync();
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

O ALTERNATIVAMENTE, si prefieres mantener app.Run(), usa esta versiÃ³n:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ejecutar seeding en startup (antes de app.Run())
using (var scope = app.Services.CreateScope())
{
    var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();
    Console.WriteLine("ğŸ”„ Applying EF Core Migrations...");
    db.Database.Migrate();
    Console.WriteLine("âœ… Migrations applied successfully!");
    
    // ğŸŒ± DATABASE SEEDING
    Console.WriteLine("ğŸŒ± Seeding database...");
    DatabaseSeeder.SeedAsync(scope.ServiceProvider).Wait();
}

Console.WriteLine($"âœ… Bosko API running on port {port}");
app.Run();
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âš ï¸  NOTA: Usar .Wait() en lugar de await requiere que no uses await en otros lugares.
          Es mejor usar await app.RunAsync() como soluciÃ³n moderna.

================================================================================
ğŸ“Œ PASO 3: VERIFICAR USING STATEMENT AL INICIO
================================================================================

Asegurarse de que existe este using al inicio de Program.cs:

using DBTest_BACK.Data;

Si no existe, agregarlo.

================================================================================
ğŸ“‹ PROGRAM.CS COMPLETO (SECCIÃ“N MODIFICADA)
================================================================================

// ... cÃ³digo anterior ...

var app = builder.Build();

// ============================================
// ğŸ“Œ APPLY EF CORE MIGRATIONS + DATABASE SEEDING
// ============================================
using (var scope = app.Services.CreateScope())
{
    var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();
    Console.WriteLine("ğŸ”„ Applying EF Core Migrations...");
    db.Database.Migrate();
    Console.WriteLine("âœ… Migrations applied successfully!");
    
    // ğŸŒ± DATABASE SEEDING
    Console.WriteLine("ğŸŒ± Seeding database...");
    await DatabaseSeeder.SeedAsync(scope.ServiceProvider);
}

// ============================================
// ğŸŒ SWAGGER
// ============================================
if (app.Environment.IsDevelopment() || app.Environment.IsProduction())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}

// ============================================
// MIDDLEWARE
// ============================================
app.UseCors("AllowFrontend");
app.UseAuthentication();
app.UseAuthorization();

app.MapControllers();

app.MapGet("/health", () => new { status = "healthy", environment = app.Environment.EnvironmentName })
    .AllowAnonymous();

Console.WriteLine($"âœ… Bosko API running on port {port}");

await app.RunAsync();  // <-- Cambiar app.Run() por app.RunAsync()

================================================================================
ğŸš€ COMANDOS PARA EJECUTAR
================================================================================

# 1. Compilar para verificar errores
dotnet build

# 2. Ejecutar la aplicaciÃ³n
dotnet run

# 3. Observar logs en consola (deberÃ­a aparecer):
   ğŸ”„ Applying EF Core Migrations...
   âœ… Migrations applied successfully!
   ğŸŒ± Seeding database...
   âœ… Seeded 3 users
   âœ… Seeded 3 user preferences
   âœ… Seeded 6 categories
   âœ… Seeded 18 products
   âœ… Seeded 4 addresses
   âœ… Seeded 6 orders
   âœ… Seeded 18 order items
   âœ… Seeded 6 shipping addresses
   âœ… Seeded 14 order status history records
   âœ… Seeded 9 notifications
   âœ… Seeded 10 activity logs
   âœ… Database seeding completed successfully!
   âœ… Bosko API running on port 8080

================================================================================
âš ï¸ SOLUCIÃ“N DE PROBLEMAS
================================================================================

ERROR: "await can only be used in an async method"
SOLUCIÃ“N: Cambiar app.Run() por await app.RunAsync()

ERROR: "DatabaseSeeder does not exist"
SOLUCIÃ“N: Verificar que DatabaseSeeder.cs estÃ¡ en Data/ y compilar

ERROR: "Violation of PRIMARY KEY constraint"
SOLUCIÃ“N: El seeder ya insertÃ³ datos previamente. ValidaciÃ³n .Any() deberÃ­a prevenir esto.

ERROR: "The INSERT statement conflicted with FOREIGN KEY constraint"
SOLUCIÃ“N: Verificar orden de inserciÃ³n en el seeder (deberÃ­a estar correcto)

ERROR: "Cannot insert duplicate key in object dbo.Users"
SOLUCIÃ“N: Los usuarios ya existen. El seeder verifica con .Any() antes de insertar.

================================================================================
âœ… RESUMEN
================================================================================

1. Agregar await DatabaseSeeder.SeedAsync(scope.ServiceProvider);
2. Cambiar app.Run() por await app.RunAsync()
3. Compilar y ejecutar
4. Verificar logs en consola
5. Probar endpoints en Swagger

================================================================================
